<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Calculating With React</title>
  </head>
  <body>

  <div id="content">
   <h1>Re-Calc:</h1>
   <p>
    Hang on to your hats everyone, it's the React Calculator!
   </p>
  </div>
  <div id="container"></div>

  <!-- External resources for Recalc Application -->
  <link rel="stylesheet" href="recalc.css">
  <script src="https://unpkg.com/react@latest/dist/react.js"></script>
  <script src="https://unpkg.com/react-dom@latest/dist/react-dom.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>

  <!-- React code starts here -->
  <script type="text/babel">

  class CalcDisplay extends React.Component {
    static get defaultProps() {
      return {
        displayNumber: 0
      };
    }

    render() {
      return (
        <div className="calcDisplay">
          {this.props.displayNumber}
        </div>
      );
    }
  };

  class CalcButton extends React.Component {

    handleClick() {
      this.props.ifClicked(this.props.value);
    }

    render() {
      return (
        <div className="calcButton" onClick={this.handleClick.bind(this)} >
          {this.props.value}
        </div>
      );
    }
  }

  class Calculator extends React.Component {

    constructor(props) {
      super(props);
      this.state = {
        operand1: '0',
        operand2: '0',
        initial: true,
      };

      // Bind this to class functions to avoid doing it when specifying
      // callbacks in JSX
      this.updateOperand = this.updateOperand.bind(this);
      this.doDiv = this.doDiv.bind(this);
      this.doMul = this.doMul.bind(this);
      this.doAdd = this.doAdd.bind(this);
      this.doSub = this.doSub.bind(this);
      this.doCalc = this.doCalc.bind(this);
      this.doClear = this.doClear.bind(this);
    }

    updateOperand(value) {
      let newVal = value;

      if( ! this.state.initial ) {
        newVal = this.state.operand1 + value;
      }

      this.setState({operand1: newVal,
                      initial: false});
    }

    prepCalc(calcFn) {
      this.setState({operand2: this.state.operand1,
                     calcFn: calcFn,
                     initial: true});
    }

    doDiv() {
      this.setState({operand1: this.state.operand2 / this.state.operand1});
    }

    doMul() {
      this.setState({operand1: this.state.operand2 * this.state.operand1});
    }

    doSub() {
      this.setState({operand1: this.state.operand2 - this.state.operand1});
    }

    doAdd() {
      this.setState({operand1: parseInt(this.state.operand2) + parseInt(this.state.operand1)});
    }

    doCalc() {
      this.state.calcFn();
      this.setState({initial: true});
    }

    doClear() {
      this.setState({
        operand1: '0',
        operand2: '0',
        calcFn: '',
        initial: true,
      });
    }

    render() {
      return(
        <div className="calculator">
          <CalcDisplay displayNumber={this.state.operand1} />
          <div>
            <CalcButton value="1" ifClicked={this.updateOperand} />
            <CalcButton value="2" ifClicked={this.updateOperand} />
            <CalcButton value="3" ifClicked={this.updateOperand} />
            <CalcButton value="/" ifClicked={this.prepCalc.bind(this, this.doDiv)} />
          </div>
          <div>
            <CalcButton value="4" ifClicked={this.updateOperand} />
            <CalcButton value="5" ifClicked={this.updateOperand} />
            <CalcButton value="6" ifClicked={this.updateOperand} />
            <CalcButton value="*" ifClicked={this.prepCalc.bind(this, this.doMul)} />
          </div>
          <div>
            <CalcButton value="7" ifClicked={this.updateOperand} />
            <CalcButton value="8" ifClicked={this.updateOperand} />
            <CalcButton value="9" ifClicked={this.updateOperand} />
            <CalcButton value="-" ifClicked={this.prepCalc.bind(this, this.doSub)} />
          </div>
          <div>
            <CalcButton value="C" ifClicked={this.doClear} />
            <CalcButton value="0" ifClicked={this.updateOperand} />
            <CalcButton value="=" ifClicked={this.doCalc} />
            <CalcButton value="+" ifClicked={this.prepCalc.bind(this, this.doAdd)} />
          </div>
        </div>
      );
    }
  }

  ReactDOM.render(
    <Calculator />,
    document.getElementById('container')
  );

	</script>

  </body>
</html>
